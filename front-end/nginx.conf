# Enable gzip compression
gzip on;
gzip_types text/plain application/javascript text/css application/json application/xml+rss image/svg+xml;
gzip_min_length 256;
gzip_vary on;

server {
  listen 5173;
  server_name localhost;

  # Serve static assets with long-term caching
  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    root /usr/share/nginx/html;
    expires 1y;
    access_log off;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), microphone=()" always;
  }

  location / {
    root   /usr/share/nginx/html;
    index  index.html index.htm;
    # This line is the magic for SPAs. If a file is not found,
    # it falls back to index.html to allow client-side routing.
    try_files $uri $uri/ /index.html;
    # Security headers for HTML entry point
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), microphone=()" always;
  }
}

# Strict-Transport-Security	Enforces HTTPS (if behind TLS)
# X-Content-Type-Options	Prevents MIME-type sniffing
# X-Frame-Options	Blocks clickjacking via iframes
# Referrer-Policy	Controls referrer info sent to other sites
# Permissions-Policy	Restricts browser features like geolocation, mic